{ZL.Source id="常规商品数据源"/}<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>{SField sid="常规商品数据源" FD="Proname" page="0"/}</title>
<meta name="Keywords" content="{SField sid="常规商品数据源" FD="Meta_Keywords" page="0"/}" />
<meta name="description" content="{SField sid="常规商品数据源" FD="Meta_Description" page="0"/}" />
{ZL:Boot()/}
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
<link href="/dist/css/weui.min.css" rel="stylesheet"/>
<link href="{$CssDir/}global.css?Version={ZL.Label id="前端样式版本号"/}" rel="stylesheet"/>
<script type="text/javascript" src="{$CssDir/}js/jquery.imagezoom.min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ynCD23qRFoyWBYk0M3bF1VEk"></script>
<script type="text/javascript" src="/JS/Modal/APIResult.js"></script>
<script src="{$CssDir/}js/jquery-ui.min.js"></script>
<script src="/JS/Controls/B_User.js"></script>
<style>
.slider{display:none}/*用于获取更加体验*/
.focus span{width:10px;height:10px;margin-right:10px;border-radius:50%;background:#666;font-size:0}
.focus span.current{background:#fff}
.slider ul { margin-bottom:0; padding-left:0; list-style:none;}
.shop_list .col-xs-12 { padding-left:5px; padding-right:5px;}
.shop_list_c { margin-top:10px;}
.shop_list_cm span { height:48px; overflow:hidden;}
.shop_list_cp .btn { padding:5px; font-size:10px;}
.shop_li.st_cp strong { font-size:1.2em; line-height:normal;}
.slider li a span { display:block; position:absolute; padding-left:50px; top:50%; text-align:center; color:#fff; font-family:"ZoomlaXingtiJ3"; text-shadow:0 0 5px rgba(0,0,0,0.55); font-size:2em;}
#home img { max-width:100%;}
.mshop_bottom { position:fixed; bottom:0; padding-top:10px; padding-bottom:10px; width:100%; background:#fff; border-top:1px solid #ddd; font-family: "STHeiti","Microsoft YaHei","黑体","arial";}
.mshop_bottom ul { margin-top:5px; margin-bottom:0; padding-left:5px; padding-right:5px; list-style:none;}
.mshop_bottom li .btn { width:100%;}
.mshop_bottom p { padding-left:10px; padding-right:10px;}
</style>
</head>
<body>
<div class="hidden-xs">
{ZL.Label id="全站头部"/}
<div class="shop_banner"></div>
</div>
<div class="visible-xs">
<nav class="navbar navbar-default navbar-fixed-top" id="wei_nav">
<div class="container-fluid">
<!-- Brand and toggle get grouped for better mobile display -->
<div class="navbar-header">
<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="{ZL:GetNodeLinkUrl(2)/}"><h3>总店</h3></a>
</div>
<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
<ul class="nav navbar-nav" style="margin-bottom:0;">
{ZL.Label id="输出指定节点标题_无时间属性" NodeID="2" TitleNum="30" ShowNum="10" /}
<li><a href="/Class_2/Default.aspx" class="text-center btn btn-warning btn-sm" style="font-size:1em;">查看更多门店</a></li>
</ul>
</div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</nav>
<div style="height:50px;"></div>
<div class="slider">
<ul>
<script>
var pics='{SField sid="常规商品数据源" FD="picture" page="0"/}';
if(pics!="")
{
	var jsonstr=JSON.parse(pics);
	if(jsonstr.length>0)
	{
		for(i=0;i<jsonstr.length;i++)
		{
			document.write('<li><img src="/UploadFiles/'+jsonstr[i].url+'" mid="/UploadFiles/'+jsonstr[i].url+'" big="/UploadFiles/'+jsonstr[i].url+'" alt="'+jsonstr[i].desc+'"></li>');
		}
	}
}
</script>
</ul>
</div>
</div>

<div class="container">
<div class="mySites hidden-xs">
<ul class="breadcrumb">
<li><a href="/">首页</a></li>
{ZL.Label id="输出多级节点导航_V3" NodeID="{SField sid="常规商品数据源" FD="NodeID" page="0"/}" ShowNum="30" /}
<li class="active">{SField sid="常规商品数据源" FD="ProName" page="0"/}</li>
</ul>
</div>
<div class="row">
<div class="col-lg-5 col-md-5 col-sm-5 col-xs-12 hidden-xs">
<div class="box">
<div class="tb-booth tb-pic tb-s310">
<a href='{ZL:GetPicUrl({SField sid="常规商品数据源" FD="Thumbnails" page="0"/})/}'><img src='{ZL:GetPicUrl({SField sid="常规商品数据源" FD="Thumbnails" page="0"/})/}' alt='{SField sid="常规商品数据源" FD="Proname" page="0"/}' rel='{ZL:GetPicUrl({SField sid="常规商品数据源" FD="Thumbnails" page="0"/})/}' class="jqzoom" alt="{SField sid="常规商品数据源" FD="Proname" page="0"/}" /></a>
</div>
<div class="row">
<ul class="tb-thumb list-unstyled" id="thumblist">
<li class="col-lg-2 col-md-2 col-sm-2 col-xs-2 tb-selected"><div class="tb-pic tb-s40"><a href="javascript:;"><img src="{ZL:GetPicUrl({SField sid="常规商品数据源" FD="Thumbnails" page="0"/})/}" mid="{ZL:GetPicUrl({SField sid="常规商品数据源" FD="Thumbnails" page="0"/})/}" big="{ZL:GetPicUrl({SField sid="常规商品数据源" FD="Thumbnails" page="0"/})/}" alt="{SField sid="常规商品数据源" FD="Proname" page="0"/}"></a></div></li>
<script>
var pics='{SField sid="常规商品数据源" FD="picture" page="0"/}';
if(pics!="")
{
	var jsonstr=JSON.parse(pics);
	if(jsonstr.length>0)
	{
		for(i=0;i<jsonstr.length;i++)
		{
			document.write('<li class="col-lg-2 col-md-2 col-sm-2 col-xs-2"><div class="tb-pic tb-s40"><a href="javascript:;"><img src="/UploadFiles/'+jsonstr[i].url+'" mid="/UploadFiles/'+jsonstr[i].url+'" big="/UploadFiles/'+jsonstr[i].url+'" alt="'+jsonstr[i].desc+'"></a></div></li>');
		}
	}
}
</script>
</ul>
</div>
</div>


</div>
<div  class="col-lg-7 col-md-7 col-sm-7 col-xs-12">
<div class="shop_detial">
<h1>{SField sid="常规商品数据源" FD="Proname" page="0"/}</h1>
<p>￥<strong>{ZL:GetMoney({SField sid="常规商品数据源" FD="LinPrice" page="0"/},2,1)/}</strong><span>￥{ZL:GetMoney({SField sid="常规商品数据源" FD="ShiPrice" page="0"/},2,1)/}</span></p>
<div class="shop_detial_c">
<ul>
<li><span>月售：</span>{SField sid="常规商品数据源" FD="ys" page="0"/} 份</li>
<li><span>品牌：</span>{SField sid="常规商品数据源" FD="brand" page="0"/}</li>
</ul>
</div>
<div class="to_buy hidden-xs">
<form id="form1" name="form1" method="post" action="/Cart/Cart1.aspx" style="margin-bottom:10px;">
<input name="id" type="hidden" id="id" value="{SField sid="常规商品数据源" FD="ID" page="0"/}" />
<input name="remark" id="remark"  type="hidden" value="{$GetUrldecode({$GetRequest(remark)$})$}" />
<button class="J_minus btn btn-default" type="button"><i class="fa fa-minus"></i></button>
<input name="Pronum" class="J_input form-control" id="Pronum" type="text" value="1">
<button class="J_add btn btn-default" type="button"><i class="fa fa-plus"></i></button>
<button type="submit" class="btn btn-danger"><i class="fa fa-shopping-cart"></i> 立即购买</button>
<button type="button" onClick="AddCart()" class="btn btn-danger hidden-xs"><i class="fa fa-plus-square"></i> 加入购物车</button>
<a href="/User/Content/MyFavite_Shop.aspx?type=2" class="btn btn-link hidden-xs"><i class="fa fa-eye"></i> 关注商品</a>
</form>
</div>
</div>
</div>
</div>

<ul class="nav nav-tabs margin_top20" style="margin-bottom:20px;">
<li class="active"><a href="javascript:;">同类商品</a></li>
</ul>
<div class="row men_shoplist">
<div class="clearfix"></div>
<div class="men_shoplist_t text-center"><i class="fa fa-spinner fa-spin"></i></div>
</div>
<div class="text-center">
<button type="button" class="btn btn-info" onClick="GetMorePro();">加载更多</button>
</div>


<!--内容主体开始 -->
<ul class="nav nav-tabs margin_top20">
<li class="active"><a href="#home" data-toggle="tab">商品详细</a></li>
</ul>
<!-- Tab panes -->
<div class="tab-content">
<div class="tab-pane active" id="home">{SField sid="常规商品数据源" FD="Procontent" page="0"/}</div>
</div>

<!--右 --> 
<div class="iframe_comm hidden-xs" id="iframe_comm">
<iframe id="comm_ifr" scrolling="no" onload="IfrAutoHeight();" src='/User/Order/ShareList.aspx?ProID={SField sid="常规商品数据源" FD="ID" page="0"/}' style="width:100%;" align="middle" frameborder="0"></iframe>
</div>
</div>   

<div class="hidden-xs">
{ZL.Label id="全站底部"/} 
</div>

<div class="visible-xs">
<div id="actionSheet_wrap">
<div class="weui_mask_transition" id="mask"></div>
<div class="weui_actionsheet" id="weui_actionsheet" style="background:#fff;">
<div class="mobile_buy">
<div class="mobile_buy_t">
<div class="weui_media_box weui_media_appmsg">
<div class="weui_media_hd">
<img class="weui_media_appmsg_thumb" src="{ZL:GetPicUrl({SField sid="常规商品数据源" FD="Thumbnails" page="0"/})/}" alt="{SField sid="常规商品数据源" FD="Proname" page="0"/}" onerror="javascript:this.src='/UploadFiles/nopic.gif';" />
</div>
<div class="weui_media_bd">
<h4 class="weui_media_title">{SField sid="常规商品数据源" FD="Proname" page="0"/}</h4>
<p class="weui_media_desc"><i class="fa fa-rmb"></i> {ZL:GetMoney({SField sid="常规商品数据源" FD="LinPrice" page="0"/},2,1)/}</p>
</div>
</div>
</div>
<div class="mobile_buy_n">
<div class="weui_cells">
<div class="weui_cell">
<div class="weui_cell_bd weui_cell_primary">
<p>所属门店：</p>
</div>
<div class="weui_cell_ft">{ZL.Label id="输出所属门店名称" UserName="{SField sid="常规商品数据源" FD="AddUser" page="0"/}" /}</div>
</div>
<div class="weui_cell">
<div class="weui_cell_bd weui_cell_primary">
<p>购买数量：</p>
</div>
<div class="weui_cell_ft">
<form id="form2" name="form2" method="post" action="/Cart/Cart1.aspx">
<input name="id" type="hidden" value="{SField sid="常规商品数据源" FD="ID" page="0"/}" />
<input name="ProClass" type="hidden" value="{SField sid="常规商品数据源" FD="ProClass" page="0"/}" />
<input name="remark" type="hidden" value="{$GetUrldecode({$GetRequest(remark)$})$}" />
<button class="J_minus btn btn-default btn-sm" type="button"><i class="fa fa-minus"></i></button>
<input name="Pronum" class="J_input form-control input-sm" id="Pronum1" type="text" value="1" />
<button class="J_add btn btn-default btn-sm" type="button"><i class="fa fa-plus"></i></button>
</form>
</div>
</div>
</div>
</div>
<div class="mobile_buy_b">
<button class="btn btn-warning btn-sm btn-block" style="display:none;" onClick="NextStep();">下一步</button>
<button class="btn btn-warning btn-sm btn-block" style="display:none;" onClick="AddCartC();">加入购物车</button>
</div>
<div id="actionsheet_cancel"><span class="fa-stack fa-lg"><i class="fa fa-close fa-stack-1x"></i><i class="fa fa-circle-thin fa-stack-2x"></i></span></div>
</div>
</div>
</div>

<div style="height:104px;"></div>
<div class="mshop_bottom">
<ul style="display:none;">
<li class="col-xs-6 padding5"><button class="btn btn-danger" onClick="ShowBuy('0');">立即购买</button></li>
<li class="col-xs-6 padding5"><button class="btn btn-warning" onClick="ShowBuy('1');">加入购物车</button></li>
<div class="clearfix"></div>
</ul>
</div>
</div>
<div class="closed_div" style="display:none;">
<p>已经打佯，请于每天8点-20点来点餐，我们会员商城更精彩哦!</p>
<a href="#" class="btn btn-danger">点击进入</a>
</div>
<div class="modal-backdrop fade in" style="display:none;" id="closed_body"></div>

<div class="mobile_cart"><a href="/Cart/Cart1.aspx?ProClass={SField sid="常规商品数据源" FD="ProClass" page="0"/}&remark="><i class="fa fa-shopping-cart"></i><span>(<i class="fa fa-spinner fa-spin"></i>)</span></a></div>

<div id="toast" style="display:none;">
<div class="weui_mask_transparent"></div>
<div class="weui_toast">
<i class="weui_icon_toast"></i>
<p class="weui_toast_content">加入成功</p>
</div>
</div>

{ZL.Label id="微信弹出菜单"/}
</body>
</html>
<script>
//商品图片切换 
$(document).ready(function(){
	$(".jqzoom").imagezoom();
	$("#thumblist li a").click(function(){
		$(this).parents("li").addClass("tb-selected").siblings().removeClass("tb-selected");
		$(".jqzoom").attr('src',$(this).find("img").attr("mid"));
		$(".jqzoom").attr('rel',$(this).find("img").attr("big"));
	});
	$(".tese_l>ul>li").click(function(){
		$(this).find("ul").slideToggle();
	})
});
/*商品加减*/
$.fn.iVaryVal=function(iSet){
	iSet=$.extend({Minus:$('.J_minus'),Add:$('.J_add'),Input:$('.J_input'),Min:0,Max:20,Fun:null},iSet);
	var C=null,O=null;
	//输出值全局对象[若担心全局对象污染，可定义一个hidden表单，向其传值]
	$GLOBAL={};
	//增加
	iSet.Add.each(function(i){
		$(this).click(function(){
			O=parseInt(iSet.Input.eq(i).val());
			(O+1<=iSet.Max) || (iSet.Max==null) ? iSet.Input.eq(i).val(O+1) : iSet.Input.eq(i).val(iSet.Max);
			//输出当前改变后的值
			$GLOBAL.val=iSet.Input.eq(i).val();
			$GLOBAL.index=i;
			//回调函数
			if (typeof iSet.Fun == 'function') {
				iSet.Fun.call(this);
			}
		});
	});
	//减少
	iSet.Minus.each(function(i){
		$(this).click(function(){
			O=parseInt(iSet.Input.eq(i).val());
			O-1<iSet.Min ? iSet.Input.eq(i).val(iSet.Min) : iSet.Input.eq(i).val(O-1);
			$GLOBAL.val=iSet.Input.eq(i).val();
			$GLOBAL.index=i;
			//回调函数
			if (typeof iSet.Fun == 'function'){
				iSet.Fun.call(this);
			}
		});
	});
	//手动
	iSet.Input.bind({
		'click':function(){
			O=parseInt($(this).val());
			$(this).select();
		},
		'keyup':function(e){
			if($(this).val()!=''){
				C=parseInt($(this).val());
				//非负整数判断
				if(/^[1-9]\d*|0$/.test(C)){
					$(this).val(C);
					O=C;
				}
				else{
					$(this).val(O);
				}
			}
			//键盘控制：上右--加，下左--减
			if(e.keyCode==38 || e.keyCode==39){
				iSet.Add.eq(iSet.Input.index(this)).click();
			}
			if(e.keyCode==37 || e.keyCode==40){
				iSet.Minus.eq(iSet.Input.index(this)).click();
			}
			//输出当前改变后的值
			$GLOBAL.val=$(this).val();
			$GLOBAL.index=iSet.Input.index(this);
			//回调函数
			if (typeof iSet.Fun == 'function') {
				iSet.Fun.call(this);
			}
		},
		'blur':function(){
			$(this).trigger('keyup');
			if($(this).val()==''){
				$(this).val(O);
			}
			//判断输入值是否超出最大最小值
			if(iSet.Max){
				if(O>iSet.Max){
					$(this).val(iSet.Max);
				}
			}
			if(O<iSet.Min){
				$(this).val(iSet.Min);
			}
			//输出当前改变后的值
			$GLOBAL.val=$(this).val();
			$GLOBAL.index=iSet.Input.index(this);
			//回调函数
			if (typeof iSet.Fun == 'function') {
				iSet.Fun.call(this);
			}
		}
	});
}
//调用
$( function() {
	$('.i_box').iVaryVal({Fun:function(){ }});
});
function AddCart()
{
	if($("#Pronum").val()>0)
	{
		$.post("/Cart/Cart1.aspx?ID="+$("#id").val()+"&Pronum="+$("#Pronum").val());
		alert("加入购物车成功！")
	}
	else
		alert("商品数量不正确！");
}
function addfav()
{
	$.post("/API/mod/collect.ashx", {action:"add",favurl:"/Shop.aspx?itemid={SField sid="常规商品数据源" FD="ID" page="0"/}",infoid:"{SField sid="常规商品数据源" FD="ID" page="0"/}",type:2,title:"{SField sid="常规商品数据源" FD="Title" page="0"/}"},function(data){
		var model=JSON.parse(data);
		if(APIResult.isok(model))
		{
			alert("收藏成功!");
		}
		else
		{
			alert("收藏失败!原因:"+model.retmsg);
		}
	});
}

(function($){
    $.fn.yxMobileSlider = function(settings){
        var defaultSettings = {
            width: '100%', //容器宽度
            height: 'auto', //容器高度
            during: 5000, //间隔时间
            speed:30 //滑动速度
        }
        settings = $.extend(true, {}, defaultSettings, settings);
        return this.each(function(){
            var _this = $(this), s = settings;
            var startX = 0, startY = 0; //触摸开始时手势横纵坐标 
            var temPos; //滚动元素当前位置
            var iCurr = 0; //当前滚动屏幕数
            var timer = null; //计时器
            var oMover = $("ul", _this); //滚动元素
            var oLi = $("li", oMover); //滚动单元
            var num = oLi.length; //滚动屏幕数
            var oPosition = {}; //触点位置
            var moveWidth = s.width; //滚动宽度
            //初始化主体样式
            _this.width(s.width).height(s.height).css({
                position: 'relative',
                overflow: 'hidden',
				margin:'0 auto'
            }); //设定容器宽高及样式
            oMover.css({
                position: 'absolute',
                left: 0
            });
            oLi.css({
                float: 'left',
                display: 'inline'
            });
            $("img", oLi).css({
                width: '100%',
                height: '100%'
            });
            //初始化焦点容器及按钮
            _this.append('<div class="focus"><div></div></div>');
            var oFocusContainer = $(".focus");
            for (var i = 0; i < num; i++) {
                $("div", oFocusContainer).append("<span></span>");
            }
            var oFocus = $("span", oFocusContainer);
            oFocusContainer.css({
                minHeight: $(this).find('span').height() * 2,
                position: 'absolute',
                bottom: 0
                //background: 'rgba(0,0,0,0.5)'
            })
            $("span", oFocusContainer).css({
                display: 'block',
                float: 'left',
                cursor: 'pointer'
            })
            $("div", oFocusContainer).width(oFocus.outerWidth(true) * num).css({
                position: 'absolute',
                //right: 10,
                //top: '50%',
				left:'50%',
				bottom:10,
                marginTop: -$(this).find('span').width() / 2,
				marginLeft: -$(this).find('span').length*10
            });
            oFocus.first().addClass("current");
            //页面加载或发生改变
            $(window).bind('resize load', function(){
                if (isMobile()) {
                    mobileSettings();
                    bindTochuEvent();
                }
                oLi.width(_this.width()).height(_this.height());//设定滚动单元宽高
                oMover.width(num * oLi.width());
                oFocusContainer.width(_this.width()).height(_this.height() * 0.15).css({
                    zIndex: 2
                });//设定焦点容器宽高样式
                _this.fadeIn(300);
            });
            //页面加载完毕BANNER自动滚动
            autoMove();
            //PC机下焦点切换
            if (!isMobile()) {
                oFocus.hover(function(){
                    iCurr = $(this).index() - 1;
                    stopMove();
                    doMove();
                }, function(){
                    autoMove();
                })
            }
            //自动运动
            function autoMove(){
                //timer = setInterval(doMove, s.during);
            }
            //停止自动运动
            function stopMove(){
                clearInterval(timer);
            }
            //运动效果
            function doMove(){
                iCurr = iCurr >= num - 1 ? 0 : iCurr + 1;
                doAnimate(-moveWidth * iCurr);
                oFocus.eq(iCurr).addClass("current").siblings().removeClass("current");
            }
            //绑定触摸事件
            function bindTochuEvent(){
                oMover.get(0).addEventListener('touchstart', touchStartFunc, false);
                oMover.get(0).addEventListener('touchmove', touchMoveFunc, false);
                oMover.get(0).addEventListener('touchend', touchEndFunc, false);
            }
            //获取触点位置
            function touchPos(e){
                var touches = e.changedTouches, l = touches.length, touch, tagX, tagY;
                for (var i = 0; i < l; i++) {
                    touch = touches[i];
                    tagX = touch.clientX;
                    tagY = touch.clientY;
                }
                oPosition.x = tagX;
                oPosition.y = tagY;
                return oPosition;
            }
            //触摸开始
            function touchStartFunc(e){
                clearInterval(timer);
                touchPos(e);
                startX = oPosition.x;
                startY = oPosition.y;
                temPos = oMover.position().left;
            }
            //触摸移动 
            function touchMoveFunc(e){
                touchPos(e);
                var moveX = oPosition.x - startX;
                var moveY = oPosition.y - startY;
                if (Math.abs(moveY) < Math.abs(moveX)) {
                    e.preventDefault();
                    oMover.css({
                        left: temPos + moveX
                    });
                }
            }
            //触摸结束
            function touchEndFunc(e){
                touchPos(e);
                var moveX = oPosition.x - startX;
                var moveY = oPosition.y - startY;
                if (Math.abs(moveY) < Math.abs(moveX)) {
                    if (moveX > 0) {
                        iCurr--;
                        if (iCurr >= 0) {
                            var moveX = iCurr * moveWidth;
                            doAnimate(-moveX, autoMove);
                        }
                        else {
                            doAnimate(0, autoMove);
                            iCurr = 0;
                        }
                    }
                    else {
                        iCurr++;
                        if (iCurr < num && iCurr >= 0) {
                            var moveX = iCurr * moveWidth;
                            doAnimate(-moveX, autoMove);
                        }
                        else {
                            iCurr = num - 1;
                            doAnimate(-(num - 1) * moveWidth, autoMove);
                        }
                    }
                    oFocus.eq(iCurr).addClass("current").siblings().removeClass("current");
                }
            }
            //移动设备基于屏幕宽度设置容器宽高
            function mobileSettings(){
                moveWidth = $(window).width();
                var iScale = $(window).width() / s.width;
                _this.height(s.height * iScale).width($(window).width());
                oMover.css({
                    left: -iCurr * moveWidth
                });
            }
            //动画效果
            function doAnimate(iTarget, fn){
                oMover.stop().animate({
                    left: iTarget
                }, _this.speed , function(){
                    if (fn) 
                        fn();
                });
            }
            //判断是否是移动设备
            function isMobile(){
                if (navigator.userAgent.match(/Android/i) || navigator.userAgent.indexOf('iPhone') != -1 || navigator.userAgent.indexOf('iPod') != -1 || navigator.userAgent.indexOf('iPad') != -1)
				{
                    return true;
                }
                else 
				{
                    return false;
                }
            }
        });
    }
})(jQuery);
$(".slider").yxMobileSlider({width:'100%',height:(document.body.clientWidth),during:3000})
$().ready(function(e) {
	var closed=$(".mshop_bottom p").data("close");
	if(closed=="1")
	{
		$("#closed_body").show();
		$(".closed_div").show().css("margin-top","-"+($(".closed_div").height()/2)+"px");
		$("html").css("height","100%").css("overflow","hidden");
		$("body").css("height","100%").css("overflow","hidden");
		$("#form1").find(".btn-danger").removeAttr("onClick")
	}
	else
	{
		$("#closed_body").remove();
		$(".closed_div").remove();
	}
});

var cpage=1;
var para={
	lng:'',
	lat:'',
	page:cpage,
	psize:'10',
}
var geoc = new BMap.Geocoder();  
var map = new BMap.Map();
var geolocation = new BMap.Geolocation();
geolocation.getCurrentPosition(function(r){
	if(this.getStatus() == BMAP_STATUS_SUCCESS)
	{
		var mypoint = new BMap.Point(r.point.lng,r.point.lat);
		para.lng=r.point.lng;
		para.lat=r.point.lat;
		$.post('/API/nearby.ashx?action=nearpro&proid={SField sid="常规商品数据源" FD="ID" page="0"/}&proclass={SField sid="常规商品数据源" FD="ProClass" page="0"/}',para,function(data){
			data=JSON.parse(data);
			console.log(data)
			var str="";
			if(data.retcode=="1")
			{
				data=JSON.parse(data.result);
				console.log(data);
				if(data.length>0)
				{
					for(i=0;i<data.length;i++)
					{
						str+="<div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-12\"><div class=\"shop_list_p\"><a href=\"/Shop/"+data[i].id+".aspx\" title=\""+data[i].proname+"\"><img class=\"img-responsive img-thumbnail\" src=\"{$UploadDir/}"+data[i].thumbnails+"\" onerror=\"javascript:this.src='/Images/nopic.gif';\" alt=\""+data[i].proname+"\"></a><h3><a href=\"/Shop/"+data[i].id+".aspx\" title=\""+data[i].proname+"\">"+data[i].proname+"</a></h3><p class=\"shop_list_p2\">"+data[i].storename+"(距离<span style='color:#c00;'>"+data[i].distnum+"</span>米)</p><p class=\"shop_list_p1\"><span>月售：<b>"+data[i].ys+"</b>份</span><span><font class=\"red\">￥"+parseFloat(data[i].linprice).toFixed(2)+"</font>元/份</span></p><div class=\"shop_list_pb\"><div class=\"row\"><div class=\"padding10\"><div class=\"col-xs-6 padding5\"><a href=\"/Shop/"+data[i].id+".aspx\" class=\"btn btn-danger btn-block\">立即购买</a></div><div class=\"col-xs-6 padding5\"><button type=\"button\" class=\"btn btn-warning btn-block\" onClick=\"AddToCart(this,'"+data[i].id+"');\">加入购物车</a></div></div></div></div></div></div>";	
					}
					$(".men_shoplist_t").prev().before(str);
					if(data.length<=12)
						$(".men_shoplist_t").html("暂无更多商品...");
				}
				else
					$(".men_shoplist_t").html("暂无商品信息...");
			}
		});
		$(".mshop_bottom form").show();
		$(".mshop_bottom ul").show();

//		var pstr=$(".mshop_bottom p").data("map");
//		if(pstr!="")
//		{
//			pstr=pstr.split(',');
//			var point = new BMap.Point(pstr[0],pstr[1]);
//			var d = map.getDistance(mypoint,point).toFixed(2);
//			$("#dist_span").html(d+"米");
//			var t1=parseFloat(d/10000).toFixed(2);
//			if(t1<0.16)
//				t1=1/6;
//			var t2=((t1-parseInt(t1))*60).toFixed();
//			if(parseInt(t1)==0)
//				$("#minu_span").html(t2+"分钟")
//			else
//				$("#minu_span").html(parseInt(t1)+"小时"+t2+"分钟")
//			if(d>5000)
//			{
//				//$(".mshop_bottom ul").remove();
//				//$(".mshop_bottom form").remove();
//				//$("#ding_span").html("距离大于5千米不提供订餐！");
//			}
//			else
//			{
//				var t1=parseFloat(d/10000).toFixed(2);
//				if(t1<0.16)
//					t1=1/6;
//				var t2=((t1-parseInt(t1))*60).toFixed();
//				if(parseInt(t1)==0)
//					$("#minu_span").html(t2+"分钟")
//				else
//					$("#minu_span").html(parseInt(t1)+"小时"+t2+"分钟")
//				$(".mshop_bottom form").show();
//				$(".mshop_bottom ul").show();
//			}
//		}
//		geoc.getLocation(mypoint, function(rs){
//			var addComp = rs.addressComponents;
//		});
	}
});


function hideActionSheet(weuiActionsheet, mask) 
{
	weuiActionsheet.removeClass('weui_actionsheet_toggle');
	mask.removeClass('weui_fade_toggle');
	mask.on('transitionend', function () {
		mask.hide();
	}).on('webkitTransitionEnd', function () {
		mask.hide();
	})
}
function ShowBuy(n)
{
	var mask = $('#mask');
	var weuiActionsheet = $('#weui_actionsheet');
	weuiActionsheet.addClass('weui_actionsheet_toggle');
	mask.show()
		.focus()//加focus是为了触发一次页面的重排(reflow or layout thrashing),使mask的transition动画得以正常触发
		.addClass('weui_fade_toggle').one('click', function () {
		hideActionSheet(weuiActionsheet, mask);
	});
	$('#actionsheet_cancel').one('click', function () {
		hideActionSheet(weuiActionsheet, mask);
	});
	mask.unbind('transitionend').unbind('webkitTransitionEnd');
	$(".mobile_buy_b .btn").hide();
	$(".mobile_buy_b .btn:eq("+n+")").show();
}
function NextStep()
{
	form2.submit();
}
function AddToCart()
{
	var pronum=$("#Pronum1").val();
	$.post("/API/mod/shop_cart.ashx?&action=add&proclass={SField sid="常规商品数据源" FD="ProClass" page="0"/}&proid="+proid,function(data){
		data=JSON.parse(data);
		if(data.retcode=="1")
		{
			data=JSON.parse(data.result);
			for(i=0;i<data.length;i++)
			{
				pronum+=parseInt(data[i].Pronum);	
			}
			$(".mobile_cart a span").html("("+pronum+")")
		}
	});
	var cart = $('.mobile_cart');
	var imgtodrag = $(obj).parent().parent().parent().find('img').eq(0);
	if (imgtodrag) {
		var imgclone = imgtodrag.clone().offset({
			top: imgtodrag.offset().top,
			left: imgtodrag.offset().left
		}).css({
			'opacity': '1',
			'position': 'absolute',
			'height': '50px',
			'width': '50px',
			'z-index': '100',
			'padding':'0',
			'border':'none',
			'border-radius':'50px'
		}).appendTo($('body')).animate({
			'top': cart.offset().top,
			'left': cart.offset().left,
			'width': 50,
			'height': 50
		}, 1000, 'easeInOutExpo');
		setTimeout(function () {
			cart.effect('shake', { times: 2 }, 200);
		}, 1500);
		imgclone.animate({
			'width': 50,
			'height': 50
		}, function () {
			$(this).detach();
		});
	}
}
$().ready(function(e) {
	var pronum=0;
	$.post("/API/mod/shop_cart.ashx?&action=list&proclass={SField sid="常规商品数据源" FD="ProClass" page="0"/}",function(data){
		data=JSON.parse(data);
		if(data.retcode=="1")
		{
			data=JSON.parse(data.result);
			for(i=0;i<data.length;i++)
			{
				pronum+=parseInt(data[i].Pronum);	
			}
			$(".mobile_cart a span").html("("+pronum+")")
		}
	});
});
function GetMorePro()
{
	para.page++;
	$.post('/API/nearby.ashx?action=nearpro&proid={SField sid="常规商品数据源" FD="ID" page="0"/}',para,function(data){
		data=JSON.parse(data);
		var str="";
		if(data.retcode=="1")
		{
			data=JSON.parse(data.result)
			if(data.length>0)
			{
				for(i=0;i<data.length;i++)
				{
					str+="<div class=\"col-lg-3 col-md-3 col-sm-3 col-xs-12\"><div class=\"shop_list_p\"><a href=\"/Shop/"+data[i].id+".aspx\" title=\""+data[i].proname+"\"><img class=\"img-responsive img-thumbnail\" src=\"{$UploadDir/}"+data[i].thumbnails+"\" onerror=\"javascript:this.src='/Images/nopic.gif';\" alt=\""+data[i].proname+"\"></a><h3><a href=\"/Shop/"+data[i].id+".aspx\" title=\""+data[i].proname+"\">"+data[i].proname+"</a></h3><p class=\"shop_list_p2\">"+data[i].storename+"(距离<span style='color:#c00;'>"+data[i].distnum+"</span>米)</p><p class=\"shop_list_p1\"><span>月售：<b>"+data[i].ys+"</b>份</span><span><font class=\"red\">￥"+parseFloat(data[i].linprice).toFixed(2)+"</font>元/份</span></p><div class=\"shop_list_pb\"><div class=\"row\"><div class=\"padding10\"><div class=\"col-xs-6 padding5\"><a href=\"/Shop/"+data[i].id+".aspx\" class=\"btn btn-danger btn-block\">立即购买</a></div><div class=\"col-xs-6 padding5\"><button type=\"button\" class=\"btn btn-warning btn-block\" onClick=\"AddToCart(this,'"+data[i].id+"');\">加入购物车</a></div></div></div></div></div></div>";	
				}
				$(".men_shoplist_t").prev().before(str);
			}
			else
			{
				$(".men_shoplist_t").html("暂无更多商品...");
			}
		}			
	});
}
function commentAnchor() { $("html,body").animate({ scrollTop: $("#iframe_comm").offset().top - 100 }, 300); }
function IfrAutoHeight() { var $ifr = $("#comm_ifr"); $ifr.height($ifr.contents().height()); }
function addfav() {
	$.post("/API/mod/collect.ashx", {action:"add",favurl:"/Shop.aspx?itemid={SField sid="常规商品数据源" FD="ID" page="0"/}",infoid:"{SField sid="常规商品数据源" FD="ID" page="0"/}",type:2,title:"{SField sid="常规商品数据源" FD="Title" page="0"/}"},function(data){
		var model=JSON.parse(data);
		if(APIResult.isok(model))
			alert("收藏成功!");
		else
			alert("收藏失败!原因:"+model.retmsg);
	});
}
function AddToCart(obj,proid)
{
	var pronum=0;
	$(obj).attr("disabled","disabled");
	$(obj).html("<i class=\"fa fa-spinner fa-spin\"></i> 正在加入");
	$.post("/API/mod/shop_cart.ashx?&action=add&proclass={SField sid="常规商品数据源" FD="ProClass" page="0"/}&proid="+proid,function(data){
		data=JSON.parse(data);
		if(data.retcode=="1")
		{
			data=JSON.parse(data.result);
			for(i=0;i<data.length;i++)
			{
				pronum+=parseInt(data[i].Pronum);	
			}
			$(".mobile_cart a span").html("("+pronum+")")
		}
	});
	setTimeout(function(){
		$(obj).removeAttr("disabled");
		$(obj).html("加入购物车");
	},1000);
	var cart = $('.mobile_cart');
	var imgtodrag = $(obj).parent().parent().parent().parent().parent().find('img').eq(0);
	if (imgtodrag) {
		var imgclone = imgtodrag.clone().offset({
			top: imgtodrag.offset().top,
			left: imgtodrag.offset().left
		}).css({
			'opacity': '1',
			'position': 'absolute',
			'height': '50px',
			'width': '50px',
			'z-index': '100',
			'padding':'0',
			'border':'none',
			'border-radius':'50px'
		}).appendTo($('body')).animate({
			'top': cart.offset().top,
			'left': cart.offset().left,
			'width': 0,
			'height': 0
		}, 1000, 'easeInOutExpo');
		setTimeout(function () {
			cart.effect('shake', { times: 2 }, 200);
		}, 1500);
		imgclone.animate({
			'width': 0,
			'height': 0
		}, function () {
			$(this).detach();
		});
	}
}
function AddCartC()
{
	$.post("/API/mod/shop_cart.ashx?&action=add&proclass={SField sid="常规商品数据源" FD="ProClass" page="0"/}&proid={SField sid="常规商品数据源" FD="ID" page="0"/}&pronum="+$("#Pronum1").val(),function(data){
		data=JSON.parse(data);
		if(data.retcode=="1")
		{
			$("#toast").show();
			data=JSON.parse(data.result);
			var mask = $('#mask');
			var weuiActionsheet = $('#weui_actionsheet');
			hideActionSheet(weuiActionsheet, mask);
			var pronum=0;
			for(i=0;i<data.length;i++)
			{
				pronum+=parseInt(data[i].Pronum);	
			}
			$(".mobile_cart a span").html("("+pronum+")")
		}
	});
	setTimeout(function(){
		$("#toast").hide();
	},1000);
}
var buser = new B_User();//会员ajax登录状态需要结合JS/Controls/B_User.js引用同步生效
buser.IsLogged(function(data,flag){
	if(flag)
	{
		data=JSON.parse(data);
		$("#home_nav .navbar-nav.navbar-right li:eq(0)").remove();
		$("#home_nav .navbar-nav.navbar-right li:eq(0)").remove();
		var namestr=data.UserName;
		if(namestr.length>5)
			namestr=namestr.substring(0,5)+"...";
		$("#home_nav .navbar-nav.navbar-right").prepend("<li class=\"dropdown\"><a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" role=\"button\" aria-expanded=\"false\">欢迎您，"+namestr+" <span class=\"caret\"></span></a><ul class=\"dropdown-menu\" role=\"menu\"><li><a href=\"/User/Default.aspx\"><i class=\"fa fa-user\"></i> 会员中心</a></li><li><a href=\"/User/Order/OrderList.aspx\"><i class=\"fa fa-shopping-cart\"></i> 我的订单</a></li><li><a href=\"/User/Info/ConsumeDetail.aspx?SType=3\"><i class=\"fa fa-database\"></i> 我的积分</a></li><li><a href=\"javascript:;\" onclick=\"LogoutFun();\"><i class=\"fa fa-power-off\"></i> 安全退出</a></li></ul></li>");

	}
	else
	{
		$("#home_nav .navbar-nav.navbar-right li:eq(0)").show();
		$("#home_nav .navbar-nav.navbar-right li:eq(1)").show();	
	}
});
function LogoutFun()
{
	buser.Logout(function(){location=location;});
}
$(function(){
	//menu float
	var menufloatclicknumber=0;
	function menufloatin(){
		$(".menu-c").removeClass("out");
		$("#menufloat").addClass("show")
		$(".mask_menu").fadeIn();
		$("#menufloat-c").show();
		$(".menu-c-inner").removeClass("outer");
		$(".menu-c-inner").addClass("in")
		$(".menu-c-inner a").show();
		menufloatclicknumber=1;
	}
	function menufloatout(){
		$("#menufloat").removeClass("show")
		$(".mask_menu").fadeOut();
		$(".menu-c-inner").removeClass("in")
		$(".menu-c-inner").addClass("outer")
		$(".menu-c-inner a").hide();
		$(".menu-c").addClass("out");
		menufloatclicknumber=0;		
	}	   
	$("#menufloat").click(function(){
		if(menufloatclicknumber==0){ menufloatin(); }
		else { menufloatout();}			 	
	})
	$(".mask_menu").click(function(){
		menufloatout(); 
	})
});
</script>